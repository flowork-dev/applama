<div v-if="currentView === 'pos'" class="flex-1 flex flex-col md:flex-row h-full overflow-hidden animate_animated animate_fadeIn bg-[#0f111a]">

    <div class="flex-1 flex flex-col h-full overflow-hidden relative">

        <div class="bg-[#171925] border-b border-[#3a3962] p-3 z-20 shadow-md shrink-0">
            <div class="flex gap-2 mb-3">
                <div class="flex-1 relative">
                    <i class="mdi mdi-magnify absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg"></i>
                    <input v-model="searchQuery" placeholder="Cari Item / Scan SKU..."
                        class="w-full bg-[#0f111a] border border-[#3a3962] rounded-xl pl-10 pr-4 py-3 text-white outline-none focus:border-[#00b4d8] focus:ring-1 focus:ring-[#00b4d8] transition-all">
                </div>
                <button @click="openScanner('inventory')" class="bg-[#222538] w-12 rounded-xl border border-[#3a3962] text-[#00b4d8] active:scale-90 transition-transform">
                    <i class="mdi mdi-barcode-scan text-xl"></i>
                </button>
            </div>

            <div class="flex gap-2 overflow-x-auto custom-scrollbar pb-1">
                <button @click="searchQuery = ''" class="px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors" :class="searchQuery === '' ? 'bg-[#00b4d8] text-white' : 'bg-[#222538] text-gray-400 border border-[#3a3962]'">
                    SEMUA
                </button>
                <button @click="searchQuery = 'paket'" class="px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors" :class="searchQuery.toLowerCase().includes('paket') ? 'bg-[#9d4edd] text-white' : 'bg-[#222538] text-gray-400 border border-[#3a3962]'">
                    ðŸ“¦ PAKET BUNDLE
                </button>
                <button @click="searchQuery = 'promo'" class="px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors" :class="searchQuery === 'promo' ? 'bg-[#ff9f1c] text-black' : 'bg-[#222538] text-gray-400 border border-[#3a3962]'">
                    ðŸ”¥ PROMO
                </button>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto p-3 custom-scrollbar pb-24 md:pb-4">
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3">
                <div v-for="item in filteredInventory" :key="item.id" @click="POSService.addToCart(item)"
                    class="bg-[#222538] border border-[#3a3962] rounded-2xl overflow-hidden relative cursor-pointer active:scale-95 transition-all duration-100 hover:border-[#00b4d8] group shadow-lg flex flex-col h-[160px]">

                    <div class="h-1 w-full bg-gradient-to-r from-[#00b4d8] to-[#706bf3]"></div>

                    <div class="p-3 flex-1 flex flex-col justify-between">
                        <div>
                            <div v-if="item.type === 'bundle'" class="inline-block px-1.5 py-0.5 bg-[#9d4edd]/20 text-[#9d4edd] border border-[#9d4edd]/50 rounded text-[9px] font-bold mb-1">
                                PAKET
                            </div>
                            <h3 class="font-bold text-gray-100 text-sm leading-tight line-clamp-2 group-hover:text-[#00b4d8] transition-colors">
                                {{ item.name }}
                            </h3>
                            <p class="text-[10px] text-gray-500 mt-1 font-mono tracking-wide">{{ item.sku }}</p>
                        </div>

                        <div class="flex items-end justify-between mt-2">
                            <div class="flex flex-col">
                                <span class="text-[10px] text-gray-400">Harga</span>
                                <span class="text-[#00b4d8] font-bold text-md">{{ formatRupiah(item.sellPrice).replace(',00', '') }}</span>
                            </div>
                            <div class="text-[10px] px-2 py-1 rounded bg-[#171925] border border-[#3a3962]" :class="item.stock <= 5 ? 'text-red-500 border-red-900' : 'text-gray-400'">
                                Stock: {{ item.stock }}
                            </div>
                        </div>
                    </div>

                    <div class="absolute inset-0 bg-white opacity-0 active:opacity-10 transition-opacity pointer-events-none"></div>
                </div>
            </div>
        </div>

        <div class="md:hidden absolute bottom-0 left-0 right-0 bg-[#171925] border-t border-[#3a3962] p-4 flex items-center gap-4 z-30 shadow-[0_-5px_20px_rgba(0,0,0,0.5)]">
            <div class="flex-1" @click="showMobileCart = true">
                <div class="text-[10px] text-gray-400 uppercase tracking-widest mb-1 flex items-center gap-1">
                    <i class="mdi mdi-cart"></i> {{ posState.cart.reduce((a,b)=>a+b.qty,0) }} ITEM
                </div>
                <div class="text-xl font-bold text-white font-['Orbitron']">{{ formatRupiah(posTotal - posState.discount).replace(',00', '') }}</div>
            </div>
            <button @click="showMobileCart = true" class="bg-[#00b4d8] text-[#171925] font-black px-6 py-3 rounded-xl shadow-[0_0_15px_#00b4d8] active:scale-95 transition-transform flex items-center gap-2">
                BAYAR <i class="mdi mdi-arrow-right"></i>
            </button>
        </div>
    </div>

    <div :class="showMobileCart ? 'translate-y-0' : 'translate-y-full md:translate-y-0'"
         class="fixed md:static inset-0 md:inset-auto z-50 md:z-auto w-full md:w-[400px] bg-[#171925] border-l border-[#3a3962] flex flex-col h-full transition-transform duration-300 shadow-2xl">

        <div class="md:hidden p-4 border-b border-[#3a3962] flex justify-between items-center bg-[#171925]">
            <h2 class="text-lg font-bold text-white font-['Orbitron']">ORDER DETAILS</h2>
            <button @click="showMobileCart = false" class="w-8 h-8 rounded-full bg-[#222538] flex items-center justify-center text-white"><i class="mdi mdi-chevron-down"></i></button>
        </div>

        <div class="hidden md:flex p-4 border-b border-[#3a3962] justify-between items-center bg-[#171925]">
            <h2 class="text-lg font-bold text-white flex items-center gap-2 font-['Orbitron']"><i class="mdi mdi-receipt"></i> CURRENT BILL</h2>
            <button @click="posState.cart = []" class="text-[10px] bg-red-900/20 border border-red-900 text-red-500 px-3 py-1 rounded hover:bg-red-900/50 transition-colors">CLEAR</button>
        </div>

        <div class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar bg-[#0f111a]">
            <div v-if="posState.cart.length === 0" class="flex flex-col items-center justify-center h-64 text-gray-600 opacity-50">
                <i class="mdi mdi-cash-register text-6xl mb-4"></i>
                <p class="font-['Orbitron']">READY TO SERVE</p>
            </div>

            <div v-for="(item, idx) in posState.cart" :key="idx" class="bg-[#222538] p-3 rounded-xl border border-[#3a3962] flex justify-between items-center group relative overflow-hidden">
                <div class="absolute left-0 top-0 bottom-0 w-1 bg-[#706bf3]"></div>
                <div class="flex-1 pl-2">
                    <div class="text-white font-bold text-sm line-clamp-1">{{ item.name }}</div>
                    <div class="text-xs text-[#706bf3] font-mono mt-1">{{ formatRupiah(item.sellPrice * item.qty).replace(',00', '') }}</div>
                </div>

                <div class="flex items-center bg-[#171925] rounded-lg border border-[#3a3962] p-1">
                    <button @click="item.qty > 1 ? item.qty-- : POSService.removeItem(idx)" class="w-8 h-8 rounded hover:bg-red-500 hover:text-white text-gray-400 transition-colors flex items-center justify-center">
                        <i class="mdi" :class="item.qty > 1 ? 'mdi-minus' : 'mdi-trash-can-outline'"></i>
                    </button>
                    <input type="number" v-model="item.qty" class="w-10 bg-transparent text-center text-white font-bold text-sm outline-none appearance-none">
                    <button @click="item.qty++" class="w-8 h-8 rounded hover:bg-[#00b4d8] hover:text-[#171925] text-gray-400 transition-colors flex items-center justify-center">
                        <i class="mdi mdi-plus"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-[#1e2130] border-t border-[#3a3962] p-5 shrink-0 shadow-[0_-5px_20px_rgba(0,0,0,0.3)]">

            <div class="space-y-2 mb-4">
                <div class="flex justify-between text-gray-400 text-xs">
                    <span>Subtotal</span>
                    <span>{{ formatRupiah(posTotal) }}</span>
                </div>
                <div class="flex justify-between items-center text-gray-400 text-xs">
                    <span>Diskon</span>
                    <div class="flex items-center gap-1 border-b border-gray-600">
                        <span class="text-gray-500">Rp</span>
                        <input v-model="posState.discount" type="number" class="w-16 bg-transparent text-right text-white outline-none">
                    </div>
                </div>
                <div class="flex justify-between text-white text-xl font-bold font-['Orbitron'] pt-2 border-t border-gray-600">
                    <span>TOTAL</span>
                    <span class="text-[#00b4d8]">{{ formatRupiah(posTotal - posState.discount).replace(',00', '') }}</span>
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex bg-[#0f111a] border border-[#3a3962] rounded-lg overflow-hidden">
                    <div class="bg-[#222538] w-10 flex items-center justify-center text-gray-400"><i class="mdi mdi-whatsapp"></i></div>
                    <input v-model="posState.customerPhone" placeholder="No. WA (628...)" class="flex-1 bg-transparent p-3 text-sm text-white outline-none">
                </div>

                <div class="relative">
                    <input v-model="posState.cashGiven" type="number" placeholder="Uang Diterima..."
                        class="w-full bg-[#0f111a] border border-[#3a3962] rounded-lg p-3 pl-4 pr-12 text-white font-bold text-lg outline-none focus:border-[#00b4d8] transition-colors">
                    <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-xs">IDR</div>
                </div>

                <div class="grid grid-cols-4 gap-2">
                    <button @click="posState.cashGiven = (posTotal - posState.discount)" class="bg-[#222538] border border-[#3a3962] text-xs text-gray-300 py-2 rounded hover:bg-[#00b4d8] hover:text-black transition-colors">PAS</button>
                    <button @click="posState.cashGiven = 20000" class="bg-[#222538] border border-[#3a3962] text-xs text-gray-300 py-2 rounded hover:bg-[#00b4d8] hover:text-black transition-colors">20k</button>
                    <button @click="posState.cashGiven = 50000" class="bg-[#222538] border border-[#3a3962] text-xs text-gray-300 py-2 rounded hover:bg-[#00b4d8] hover:text-black transition-colors">50k</button>
                    <button @click="posState.cashGiven = 100000" class="bg-[#222538] border border-[#3a3962] text-xs text-gray-300 py-2 rounded hover:bg-[#00b4d8] hover:text-black transition-colors">100k</button>
                </div>

                <div v-if="posState.cashGiven > 0" class="flex justify-between items-center bg-[#0f111a] p-2 rounded border border-[#3a3962] border-dashed">
                    <span class="text-xs text-gray-400">KEMBALI</span>
                    <span class="font-bold text-[#ff9f1c]" :class="(posState.cashGiven - (posTotal - posState.discount)) < 0 ? 'text-red-500' : 'text-[#ff9f1c]'">
                        {{ formatRupiah(posState.cashGiven - (posTotal - posState.discount)) }}
                    </span>
                </div>

                <button @click="processPOS" class="w-full bg-gradient-to-r from-[#00b4d8] to-[#706bf3] text-white font-black py-4 rounded-xl shadow-[0_0_20px_rgba(112,107,243,0.4)] hover:shadow-[0_0_30px_rgba(112,107,243,0.6)] active:scale-[0.98] transition-all flex justify-center items-center gap-2">
                    <i class="mdi mdi-printer"></i> PROSES TRANSAKSI
                </button>
            </div>
        </div>
    </div>
</div>
